# Appraisal (Анкетирование)

## Создание

`POST /api/appraisals`

Пример сообщения в Body запроса:

```json
{
    "externalId": "externalID1104",
    "templateId": "fced54c5-9d7f-4179-ac33-b1c5ce4a5e59",
    "typeId": "82c36fae-136b-4702-9785-fa173f05c714",
    "appraiseeExternalId": "SU44617",
    "periodStart": "2018-07-01T00:00:00+03:00",
    "periodEnd": "2018-12-31T00:00:00+03:00",
    "initiatorExternalId": "SU2037",
    "status": 3,
    "participantLastDate": "2019-01-15T00:00:00+03:00",
    "requestLastDate": "2018-12-25T00:00:00+03:00",
    "feedbackLastDate": "2019-02-17T00:00:00+03:00",
    "feedbackStatus": 0,
    "mainСriterionX": 1,
    "mainСriterionY": 2,
    "resultRecommendations": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA=",
    "additionalInfo": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA="
}
```

### Описание полей

|Поле|Тип|Ограничения|Описание|
|----|--------|------------|------------|
|externalId|string| Unique |Внешний идентификатор (опциональный)|
|templateId|string|Not Null|Идентификатор шаблона анкетирования. *Справочная сущность, в API отсутствует*|
|typeId|string|Not Null |Идентификатор типа анкетирования из внешней системы. *Справочная сущность, в API отсутствует*|
|appraiseeExternalId|string|Not Null |Идентификатор пользователя из внешней системы, по которому проводится анкетирование|
|periodStart| datetime (подробнее о формате [здесь](general.md))| Not Null |Дата старта анкетирования|
|periodEnd| datetime (подробнее о формате [здесь](general.md))|Not Null |Дата окончания анкетирования|
|initiatorExternalId| string |Not Null | Идентификатор пользователя из внешней системы, запустившего анекетирование|
|status| Значения из [перечисления](#appraisal_status)| Not Null | Статус анкетирования|
|participantLastDate| datetime (подробнее о формате [здесь](general.md))|-|Крайняя контрольная дата внесения отзывов от участников|
|requestLastDate| datetime (подробнее о формате [здесь](general.md))|-|Крайняя контрольная дата открытия запросов оценивающим|
|feedbackLastDate| datetime (подробнее о формате [здесь](general.md))|-|Крайняя контрольная дата предоставление обратной связи сотруднику|
|feedbackStatus| Значения из [перечисления](#appraisal_feedbackStatus)| - | Статус работы с обратной связью|
|mainСriterionX| Значения из [перечисления](#appraisal_mainСriterionX)| - | Значение критерия оценики X |
|mainСriterionY| Значения из [перечисления](#appraisal_mainСriterionY)| - | Значение критерия оценики Y |
|resultRecommendations| string | - | Результаты и рекомендации. Строка, закодированная в Base64|
|additionalInfo| string | - | Доп. информация из внешних систем (XML). Строка, закодированная в Base64|



<a name="appraisal_status"></a>
#### Статус анкетирования
|Значение|Описание|
|----|--------|
| 1 | Активное | 
| 2 | Завершенное |
| 3 | Удаленное |
| 4 | Запланированное|
| 5 | Запрос информации из внешнего сервиса|

<a name="appraisal_feedbackStatus"></a>
#### Статус работы с обратной связью
|Значение|Описание|
|----|--------|
| 0 | Не сформулирована | 
| 1 | На согласовании |
| 2 | Утверждена |
| 3 | Предоставлена сотруднику|

<a name="appraisal_mainСriterionX"></a>
#### Значение критерия X
|Значение|Описание|
|----|--------|
| 1 | Ниже ожиданий компании | 
| 2 | Соответсвует ожиданиям компании |
| 3 | Выше ожиданий компании |

<a name="appraisal_mainСriterionY"></a>
#### Значение критерия Y
|Значение|Описание|
|----|--------|
| 1 | Ниже ожиданий компании | 
| 2 | Соответсвует ожиданиям компании |
| 3 | Выше ожиданий компании |

### Логика работы

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```.
В случае создания записи будет возвращен статус ```201 Created```, в теле ответа будет содержаться идентификатор созданной сущности, в заголовке URL.</br>

## Обновление

`PUT /api/appraisals/{id}`

где ```id``` - идентиифкатор анкетирования

### Логика работы

Сообщение в тело запроса соответствует сообщению для создания сущности. Сущность обновляется целиком (полная замена ресурса), поэтому должным быть заполнены все параметры. Если какой-то из параметров будет отсутствовать в теле запроса, то это будет воспринято как заполнение пустым значением.
</br>

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного обновления записи будет возвращен статус ```204 NoContent```.


## Частичное обновление

`PATCH /api/appraisals/{id}`

где ```id``` - идентиифкатор анкетирования

Для частичного обновления ресурса используется формат [JSON Patch](http://jsonpatch.com/). Пример Body запроса:

```json
[
    {
        "op": "replace",
        "path": "/resultRecommendations",
        "value": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA="
    }
]
```

### Логика работы

Формата JSON Patch позволяет манипулировать отдельными полями сущности (замена, копирование, удаление).
</br>

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного обновления записи будет возвращен статус ```204 NoContent```.


## Удаление


`DELETE /api/appraisals/{id}`

где `id` - идентиифкатор анкетирования


### Логика работы

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного удаления записи будет возвращен статус ```204 NoContent```.


## Получение 

#### Получение конкретной записи
`GET /api/appraisals/{id}`
где `id` - идентиифкатор анкетирования

#### Получение всех записей

`GET /api/appraisals`

### Логика работы

Если не были переданы обязательные пераметры, то будет возвращен код ```400 BadRequest ```. Если анкетирование с переданным идентификатором не будет найдено, то будет передан код ```404 NotFound```.
В случае успешного запроса возвращен статус ```200 OK```, в теле же запроса будет сообщение с данными. Пример:

```json
{
    "id": "8afd0fe8-fb78-408f-a218-91c8effa002f",
    "externalId": "externalID1104123",
    "templateId": "fced54c5-9d7f-4179-ac33-b1c5ce4a5e59",
    "typeId": "82c36fae-136b-4702-9785-fa173f05c714",
    "appraiseeId": "a7561084-127f-4bf5-867d-0787572f9949",
    "appraiseeExternalId": "SU44617",
    "periodStart": "2018-07-01T00:00:00+03:00",
    "periodEnd": "2018-12-31T00:00:00+03:00",
    "initiatorId": "4e9d939e-6904-4b33-acfc-a17375176d0c",
    "initiatorExternalId": "SU2037",
    "participantLastDate": "2019-01-15T00:00:00+03:00",
    "status": 3,
    "requestLastDate": "2018-12-25T00:00:00+03:00",
    "feedbackLastDate": "2019-02-17T00:00:00+03:00",
    "feedbackStatus": 0,
    "mainСriterionX": 1,
    "mainСriterionY": 2,
    "additionalInfo": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA=",
    "resultRecommendations": "0KLRg9GCINGA0LDQt9C90YvQtSDQv9C+0LvQtdC30L3Ri9C1INGA0LXQutC+0LzQtdC90LTQsNGG0LjQuCA="}
```

### Описание полей

|Поле|Тип|Ограничения|Описание|
|----|--------|------------|------------|
|id|string| Unique |Идентификатор анкетирования|
|externalId|string| Unique |Внешний идентификатор (опциональный)|
|templateId|string|Not Null|Идентификатор шаблона анкетирования. *Справочная сущность, в API отсутствует*|
|typeId|string|Not Null |Идентификатор типа анкетирования из внешней системы. *Справочная сущность, в API отсутствует*|
|appraiseeId|string|Not Null |Внутренний идентификатор пользователя, по которому проводится анкетирование|
|appraiseeExternalId|string|Not Null |Идентификатор пользователя из внешней системы, по которому проводится анкетирование|
|periodStart| datetime (подробнее о формате [здесь](general.md))| Not Null |Дата старта анкетирования|
|periodEnd| datetime (подробнее о формате [здесь](general.md))|Not Null |Дата окончания анкетирования|
|initiatorId| string |Not Null | Внутрениий идентификатор пользователя-инициатора.|
|initiatorExternalId| string |Not Null | Идентификатор пользователя из внешней системы, запустившего анекетирование|
|status| Значения из [перечисления](#appraisal_status)| Not Null | Статус анкетирования|
|participantLastDate| datetime (подробнее о формате [здесь](general.md))|-|Крайняя контрольная дата внесения отзывов от участников|
|requestLastDate| datetime (подробнее о формате [здесь](general.md))|-|Крайняя контрольная дата открытия запросов оценивающим|
|feedbackLastDate| datetime (подробнее о формате [здесь](general.md))|-|Крайняя контрольная дата предоставление обратной связи сотруднику|
|feedbackStatus| Значения из [перечисления](#appraisal_feedbackStatus)| - | Статус работы с обратной связью|
|mainСriterionX| Значения из [перечисления](#appraisal_mainСriterionX)| - | Значение критерия оценики X |
|mainСriterionY| Значения из [перечисления](#appraisal_mainСriterionY)| - | Значение критерия оценики Y |
|resultRecommendations| string | - | Результаты и рекомендации. Строка, закодированная в Base64|
|additionalInfo| string | - | Доп. информация из внешних систем (XML). Строка, закодированная в Base64|


В случае получения всех записей возвращается массив элементов с вышеописанным форматом.
